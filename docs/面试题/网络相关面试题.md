# 网络相关面试题



## TCP/IP相关

### 讲讲TCP 的三次握手、四次挥手？

客户端会通过IP 和 服务端建立TCP连接，若是域名则需要先进行域名解析，建立过程 需要经历三次握手。断开时则会经历四次挥手。

**三次握手**：

* 第一次握手 - 请求（SYN）：客户端首先会发送一个请求(SYN)包，然后进入 SYN_SEND状态。
* 第二次握手 - 请求之应答（SYN/ACK）：服务端收到客户端的第一个包后，会回复客户端一个应答消息(SYN/ACK)。服务端进入 SYN_RECV状态，表示请求收到了。
* 第三次握手 - 应答之应答（ACK）：客户都收到服务端的应答消息后，会再次向服务发送一个应答消息。同时进入 ESTABLISHED状态，表示应答收到了，准备开始接收后续的包。服务端收到这个应答消息，也会进入ESTABLISHED状态，准备接收客户端后续消息。

为什么要三次：

前3次的握手保证双方互相进行了一次完整的通讯，实现了数据交换，而第三次之后发送的第四次、第五次握手等都是无效的操作，会导致陷入循环。

> 网络协议中经典的红蓝军问题，这个问题表明在不可信的通道上无法设计出完全可靠的通讯协议，因为最后一个确认报文的发送，发送方用于无法知道接收方是否收到。所以仅执行必要的三次握手。



**四次挥手**：

* 第一次挥手 FIN ：客户端发起断开请求，单方面表示断开。
* 第二次挥手 ACK：服务端发送一个应答，表示我知道了。此时服务端并没有断开，因为可能还有数据需要处理，客户端也会继续等待。
* 第三次挥手 FIN/ACK：服务端处理完数据后，也发起一个断开请求。
* 第四次挥手 ACK：客户端发送一个应答，服务端收到这个应答后 两边就正式断开了。

为什么要4次，而是和握手一样的三次，主要是由于客户端发起断开时，服务端可能还在待处理的消息，所以需要处理完后才能断开。



### 客户端是如何根据 IP 地址找到服务器对应的主机的呢？

## HTTP相关

### https与http有什么区别？

https 和 http 最主要的区别就是在于安全性方面，其次就是默认端口不同。

主要讲讲安全性上的区别：

http 全程明文传输，数据十分容易被截获、修改、伪造等，可信度很低。

https 是在 tcp 之前增加了一层 安全套接层(SSL/TLS)，



### 浏览器里从输入一个网址，到最终看见网页，发生了什么？

对于HTTP请求：

* 首先是建立TCP连接，此时经过了3次握手。这样就可以开始进行TCP通讯。
  * SYN
  * SYN/ACK
  * ACK
* 接着客户端按照HTTP协议，通过TCP发送了一条HTTP报文。
* 服务端在 TCP协议层上，会回复一个 ACK。
* 服务端在HTTP层面上，会解析报文，然后处理对于业务，并再将结果封装成HTTP报文格式，再通过TCP发送给客户端。
* 客户端在 TCP 协议层同样会回复一个 ACK给服务端，表示收到了响应报文。
* 客户端解析 响应报文，处理对于数据。

若是HTTPS呢？

* 首先也是TCP建立连接，经历三次握手。
* 连接建立后，进入TLS握手阶段。
* 首先客户端发送Client Hello 消息给服务端，将TLS版本、支持的密码套件、Client_Random发送给服务端。
  * 若是1.3 还会通过Extensions扩展字段将支持的密钥交换算法以及协商参数(Client Param)
* 接着服务端回复 Server Hello，会将 版本，协商选定的密码套件, Server Random发送给客户端。
  * 若是1.3也会通过扩展字段将选定的密钥交换算法以及协商参数(Server Param) 。它们会被服务端私钥签名。
  * 若是TLS1.3，此时服务端已经可以根据参数生成预主密钥。在根据随机数和预主密钥生成主密钥。
* 服务端接着发送带有公钥的证书。
* ~~若是TLS1.2，会在发送证书协商参数，交换Client Param和 Server Param。~~
* 客户端验证证书。逐级验证证书链，之后再使用公钥验证签名，确认服务端身份。
* 验证完证书之后，客户端也获取到了所有参数，生成主密钥。
* 后续开始加密通讯。这部分就和上面的HTTP一样。
